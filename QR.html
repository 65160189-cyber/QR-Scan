<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QR Kanban - Smart Tracking Pro (Improved UX)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&family=Sarabun:wght@300;400;600;700&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', 'Sarabun', sans-serif; 
            background: #f8fafc; 
            overscroll-behavior: none;
        }

        .glass-panel { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.5); 
        }
        
        .ios-switcher-container { 
            position: relative; 
            background: #e2e8f0; 
            padding: 4px; 
            border-radius: 18px; 
            display: flex; 
            width: 100%; 
            isolation: isolate; 
        }
        .ios-slider { 
            position: absolute; 
            top: 4px; 
            bottom: 4px; 
            left: 4px; 
            width: calc(33.33% - 4px); 
            background: white; 
            border-radius: 14px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
            z-index: 0; 
        }
        .ios-tab { 
            position: relative; 
            z-index: 1; 
            flex: 1; 
            padding: 12px 0; 
            font-size: 11px; 
            font-weight: 700; 
            text-align: center; 
            color: #64748b; 
            transition: all 0.3s ease; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            gap: 4px; 
            cursor: pointer; 
        }
        
        .btn-main { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px; 
            padding: 1.1rem; 
            border-radius: 1.5rem; 
            font-weight: 800; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            width: 100%; 
        }
        .btn-main:active { transform: scale(0.96); }
        .btn-warehouse { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; }
        .btn-customer { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; }
        
        #reader { width: 100% !important; border: none !important; border-radius: 1.5rem; overflow: hidden; }
        .history-card { animation: slideUp 0.4s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .file-upload-zone {
            border: 2px dashed #e2e8f0;
            transition: all 0.3s ease;
        }
        .file-upload-zone:hover {
            border-color: #6366f1;
            background: #f1f5f9;
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            transition: all 0.2s;
        }
        .export-btn:active { transform: scale(0.95); }
    </style>
</head>
<body class="text-slate-900">

    <!-- Login Overlay -->
    <div id="loginOverlay" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-6">
        <div class="w-full max-w-sm glass-panel p-8 rounded-[2.5rem] shadow-2xl text-center">
            <div class="w-20 h-20 bg-indigo-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-xl">
                <i data-lucide="qr-code" class="w-10 h-10 text-white"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-800 tracking-tight">QR Kanban</h2>
            <p class="text-slate-500 text-sm mt-1 mb-8">ระบบจัดการรับ-ส่งสินค้าอัจฉริยะ</p>
            <div class="space-y-3">
                <button onclick="login('warehouse')" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-bold flex items-center justify-center gap-3 transition-all active:scale-95">
                    <i data-lucide="warehouse"></i> ฝ่ายคลังสินค้า
                </button>
                <button onclick="login('customer')" class="w-full bg-slate-800 text-white py-5 rounded-2xl font-bold flex items-center justify-center gap-3 transition-all active:scale-95">
                    <i data-lucide="user"></i> ฝ่ายลูกค้า
                </button>
            </div>
        </div>
    </div>

    <!-- Main App UI -->
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col hidden bg-slate-50 relative pb-10">
        <header id="appHeader" class="p-6 pb-12 rounded-b-[3.5rem] shadow-xl sticky top-0 z-50 transition-all duration-500">
            <div class="flex items-center justify-between text-white">
                <div>
                    <span id="roleLabel" class="text-[10px] font-black uppercase tracking-widest opacity-80">ROLE</span>
                    <h1 id="appTitle" class="text-2xl font-black uppercase tracking-tight">QR KANBAN</h1>
                </div>
                <div class="flex gap-2">
                    <button onclick="logout()" class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="p-6 -mt-18 space-y-6">
            <!-- Tabs Switcher -->
            <div class="ios-switcher-container shadow-md border border-white/50">
                <div id="modeSlider" class="ios-slider"></div>
                <div onclick="switchMode('scan')" id="tabScan" class="ios-tab text-indigo-600"><i data-lucide="camera" class="w-4 h-4"></i> สแกน</div>
                <div onclick="switchMode('manual')" id="tabManual" class="ios-tab"><i data-lucide="edit-3" class="w-4 h-4"></i> กรอกรหัส</div>
                <div onclick="switchMode('import')" id="tabImport" class="ios-tab"><i data-lucide="file-up" class="w-4 h-4"></i> นำเข้า</div>
            </div>

            <!-- Content Area -->
            <div class="bg-white rounded-[2.5rem] p-5 shadow-sm border border-slate-200/60 min-h-[320px] flex flex-col">
                
                <!-- 1. Scan View -->
                <div id="scanView" class="space-y-5">
                    <div class="aspect-square bg-slate-100 rounded-[2rem] overflow-hidden relative flex items-center justify-center border-2 border-dashed border-slate-200">
                        <div id="reader"></div>
                        <div id="scanPlaceholder" class="absolute text-center opacity-40">
                            <i data-lucide="qr-code" class="w-12 h-12 mx-auto mb-2"></i>
                            <p class="text-[10px] font-black uppercase">ยังไม่ได้เปิดกล้อง</p>
                        </div>
                    </div>
                    <button id="btnToggleCam" onclick="toggleCamera()" class="btn-main shadow-lg">
                        <i data-lucide="camera"></i> <span>เริ่มสแกน QR Code</span>
                    </button>
                </div>

                <!-- 2. Manual View -->
                <div id="manualView" class="hidden py-8 text-center flex-1 flex flex-col justify-center">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-widest">ใส่รหัสสินค้าเพื่อตรวจสอบ</p>
                    <input type="text" id="manualInput" placeholder="EX: KB-101" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl py-6 px-6 focus:border-indigo-500 outline-none text-center text-3xl font-black uppercase transition-all mb-6">
                    <button onclick="handleManual()" class="btn-main" id="btnManual">
                        <i data-lucide="search"></i> ค้นหาสินค้า
                    </button>
                </div>

                <!-- 3. Import View -->
                <div id="importView" class="hidden py-4 space-y-4">
                    <div class="text-center mb-4">
                        <h3 class="font-black text-slate-800">นำเข้าข้อมูล</h3>
                        <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">รองรับไฟล์ .xlsx, .xls, .pdf</p>
                    </div>
                    
                    <label class="file-upload-zone w-full flex flex-col items-center justify-center py-10 rounded-3xl cursor-pointer bg-slate-50">
                        <i data-lucide="file-spreadsheet" class="w-12 h-12 text-indigo-400 mb-2"></i>
                        <span class="text-sm font-bold text-slate-600">กดเพื่อเลือกไฟล์</span>
                        <input type="file" id="fileInput" accept=".xlsx, .xls, .pdf" class="hidden" onchange="handleFileImport(event)">
                    </label>

                    <div id="importPreview" class="hidden p-4 bg-indigo-50 rounded-2xl border border-indigo-100">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-black text-indigo-600 uppercase">เตรียมนำเข้า</span>
                            <span id="importCount" class="text-xs font-black bg-indigo-600 text-white px-2 py-1 rounded-lg">0 รายการ</span>
                        </div>
                        <div id="importList" class="max-h-32 overflow-y-auto text-[10px] font-medium text-indigo-800 space-y-1"></div>
                        <button onclick="confirmImport()" class="w-full mt-4 py-3 bg-indigo-600 text-white rounded-xl font-bold text-sm shadow-md">ยืนยันนำเข้าทั้งหมด</button>
                    </div>
                </div>
            </div>

            <!-- Result Card -->
            <div id="resultArea" class="hidden">
                <div id="resultContainer" class="bg-white rounded-[2.5rem] p-6 shadow-2xl border-2 border-white relative overflow-hidden">
                    <div id="itemStatusTag" class="absolute top-0 right-0 px-6 py-2 rounded-bl-2xl text-[10px] font-black uppercase text-white shadow-sm">STATUS</div>
                    <div class="mb-6">
                        <h3 id="itemName" class="text-xl font-black text-slate-800">ชื่อสินค้า</h3>
                        <p id="itemCode" class="text-xs font-bold text-slate-400">KB-0000</p>
                    </div>
                    <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100 mb-6">
                        <p id="itemDetail" class="text-sm text-slate-600 font-medium">รายละเอียดสินค้าจะปรากฏที่นี่</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="closeResult()" class="flex-1 py-4 bg-slate-100 text-slate-500 font-bold rounded-2xl">ยกเลิก</button>
                        <button id="actionBtn" class="flex-[2] py-4 text-white font-black rounded-2xl shadow-lg transition-transform active:scale-95">ดำเนินการ</button>
                    </div>
                </div>
            </div>

            <!-- History Section -->
            <div class="space-y-4">
                <div class="flex items-center justify-between px-2">
                    <h2 class="font-black text-slate-800 flex items-center gap-2">
                        <i data-lucide="clock" class="w-5 h-5 text-indigo-500"></i>
                        ประวัติ (<span id="historyCount">0</span>)
                    </h2>
                    <div class="flex gap-1">
                        <button onclick="exportExcel()" class="export-btn bg-green-100 text-green-700 hover:bg-green-200">
                            <i data-lucide="file-text" class="w-3.5 h-3.5"></i> Excel
                        </button>
                        <button onclick="exportPDF()" class="export-btn bg-red-100 text-red-700 hover:bg-red-200">
                            <i data-lucide="file-type-2" class="w-3.5 h-3.5"></i> PDF
                        </button>
                    </div>
                </div>
                
                <div id="historyContainer" class="space-y-3">
                    <!-- History Cards Rendered Here -->
                </div>
                <div class="flex justify-center">
                    <button onclick="clearHistory()" class="text-[10px] font-black text-slate-400 hover:text-red-500 uppercase tracking-widest py-2 transition-colors">ล้างประวัติการทำรายการ</button>
                </div>
            </div>
        </main>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-3xl text-sm font-bold shadow-2xl opacity-0 translate-y-10 transition-all z-[200] pointer-events-none">
        สำเร็จ
    </div>

    <script>
        // Mock database
        let items = {
            "KB-101": { name: "แผงวงจรหลัก", desc: "Mainboard V2 สำหรับระบบควบคุม", status: "warehouse" },
            "KB-102": { name: "เซนเซอร์วัดอุณหภูมิ", desc: "Digital Temp Sensor", status: "warehouse" }
        };

        let currentRole = 'warehouse';
        let scanner = null;
        let isCamOpen = false;
        let history = [];
        let pendingImport = [];

        function login(role) {
            currentRole = role;
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            setupTheme();
            renderHistory();
        }

        function setupTheme() {
            const header = document.getElementById('appHeader');
            const roleLab = document.getElementById('roleLabel');
            const btnCam = document.getElementById('btnToggleCam');
            const btnMan = document.getElementById('btnManual');

            if (currentRole === 'warehouse') {
                header.className = "p-6 pb-12 rounded-b-[3.5rem] shadow-xl sticky top-0 z-50 bg-indigo-600";
                roleLab.innerText = "SENDER ROLE (คลังสินค้า)";
                btnCam.className = "btn-main btn-warehouse shadow-lg shadow-indigo-200";
                btnMan.className = "btn-main btn-warehouse shadow-lg shadow-indigo-200";
            } else {
                header.className = "p-6 pb-12 rounded-b-[3.5rem] shadow-xl sticky top-0 z-50 bg-orange-600";
                roleLab.innerText = "RECEIVER ROLE (ลูกค้า)";
                btnCam.className = "btn-main btn-customer shadow-lg shadow-orange-200";
                btnMan.className = "btn-main btn-customer shadow-lg shadow-orange-200";
            }
            switchMode('scan');
            if(window.lucide) lucide.createIcons();
        }

        // --- BUSINESS LOGIC (UI IMPROVED) ---

        function handleManual() {
            const inputEl = document.getElementById('manualInput');
            const val = inputEl.value.trim().toUpperCase();
            if (val) {
                handleScan(val);
                // ไม่ลบทันทีที่ตรงนี้ เพราะผู้ใช้อาจจะขอดูข้อมูลก่อนลบ
            }
        }

        function handleScan(code) {
            let data = items[code];
            document.getElementById('resultArea').classList.remove('hidden');
            document.getElementById('itemCode').innerText = code;
            const tag = document.getElementById('itemStatusTag');
            const btn = document.getElementById('actionBtn');

            if (!data) {
                if (currentRole === 'warehouse') {
                    document.getElementById('itemName').innerText = "สินค้าใหม่";
                    document.getElementById('itemDetail').innerText = "ยังไม่มีในระบบ กดเพื่อลงทะเบียนส่ง";
                    tag.innerText = "NEW"; tag.className = "absolute top-0 right-0 px-6 py-2 rounded-bl-2xl text-[10px] font-black uppercase bg-slate-800 text-white";
                    btn.innerText = "ส่งสินค้า"; btn.className = "flex-[2] py-4 bg-indigo-600 text-white font-black rounded-2xl shadow-lg";
                    btn.onclick = () => { 
                        items[code] = { name: "สินค้าใหม่ ("+code+")", desc: "Auto-Add", status: 'warehouse' }; 
                        updateProduct(code, 'shipping'); 
                    };
                    btn.disabled = false;
                } else {
                    document.getElementById('itemName').innerText = "ไม่พบรหัส";
                    document.getElementById('itemDetail').innerText = "ไม่มีข้อมูลการจัดส่งในระบบ";
                    tag.innerText = "INVALID"; tag.className = "absolute top-0 right-0 px-6 py-2 rounded-bl-2xl text-[10px] font-black uppercase bg-red-500 text-white";
                    btn.innerText = "รับไม่ได้"; btn.className = "flex-[2] py-4 bg-slate-300 text-white font-black rounded-2xl";
                    btn.disabled = true;
                }
                return;
            }

            document.getElementById('itemName').innerText = data.name;
            document.getElementById('itemDetail').innerText = data.desc;
            
            if (currentRole === 'warehouse') {
                const isAvail = (data.status === 'warehouse' || data.status === 'delivered');
                tag.innerText = isAvail ? "AVAILABLE" : "SHIPPING";
                tag.className = `absolute top-0 right-0 px-6 py-2 rounded-bl-2xl text-[10px] font-black uppercase text-white ${isAvail ? 'bg-blue-500' : 'bg-slate-500'}`;
                btn.innerText = isAvail ? "เริ่มส่งสินค้า" : "กำลังจัดส่ง...";
                btn.className = `flex-[2] py-4 font-black rounded-2xl ${isAvail ? 'bg-indigo-600 shadow-lg text-white' : 'bg-slate-300 text-white'}`;
                btn.onclick = isAvail ? () => updateProduct(code, 'shipping') : null;
                btn.disabled = !isAvail;
            } else {
                const canRecv = (data.status === 'shipping');
                tag.innerText = canRecv ? "IN TRANSIT" : (data.status === 'delivered' ? "RECEIVED" : "WAITING");
                tag.className = `absolute top-0 right-0 px-6 py-2 rounded-bl-2xl text-[10px] font-black uppercase text-white ${canRecv ? 'bg-orange-500' : 'bg-slate-400'}`;
                btn.innerText = canRecv ? "ยืนยันรับสินค้า" : "รับไม่ได้";
                btn.className = `flex-[2] py-4 font-black rounded-2xl ${canRecv ? 'bg-orange-600 shadow-lg text-white' : 'bg-slate-300 text-white'}`;
                btn.onclick = canRecv ? () => updateProduct(code, 'delivered') : null;
                btn.disabled = !canRecv;
            }
        }

        function updateProduct(code, newStatus) {
            // อัปเดตข้อมูล
            items[code].status = newStatus;
            addHistory(code, newStatus);
            
            // ล้างค่าในช่อง Input Manual เพื่อให้พร้อมสำหรับการกรอกครั้งต่อไป
            const manualInput = document.getElementById('manualInput');
            if (manualInput) manualInput.value = "";
            
            // แจ้งเตือนและซ่อน Result
            showToast("ทำรายการสำเร็จ");
            closeResult();
            renderHistory();
        }

        function addHistory(code, status) {
            history.unshift({
                code: code,
                name: items[code].name,
                status: status,
                time: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })
            });
        }

        function renderHistory() {
            const container = document.getElementById('historyContainer');
            document.getElementById('historyCount').innerText = history.length;
            if (history.length === 0) {
                container.innerHTML = `<div class="text-center py-12 bg-white/50 rounded-[2.5rem] border border-dashed border-slate-200"><i data-lucide="package-open" class="w-10 h-10 text-slate-300 mx-auto mb-3"></i><p class="text-xs font-bold text-slate-400 uppercase tracking-widest">ยังไม่มีรายการ</p></div>`;
            } else {
                container.innerHTML = history.map(item => `
                    <div class="history-card bg-white p-5 rounded-[1.8rem] border border-slate-200/60 shadow-sm flex items-center gap-4">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center ${item.status === 'shipping' ? 'bg-orange-50 text-orange-600' : 'bg-green-50 text-green-600'}">
                            <i data-lucide="${item.status === 'shipping' ? 'truck' : 'check-circle'}" class="w-5 h-5"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <span class="text-[9px] font-black text-slate-400 uppercase">${item.code}</span>
                                <span class="text-[8px] font-black px-2 py-0.5 rounded ${item.status === 'shipping' ? 'bg-orange-100 text-orange-700' : 'bg-green-100 text-green-700'}">
                                    ${item.status === 'shipping' ? 'ส่ง' : 'รับ'}
                                </span>
                            </div>
                            <h4 class="text-sm font-bold text-slate-800 truncate">${item.name}</h4>
                            <p class="text-[9px] font-bold text-slate-400">${item.time}</p>
                        </div>
                    </div>
                `).join('');
            }
            if(window.lucide) lucide.createIcons();
        }

        // --- EXPORT FUNCTIONS ---

        function exportExcel() {
            if (history.length === 0) return showToast("ไม่มีข้อมูลให้นำออก");
            const data = history.map((item, index) => ({
                "ลำดับ": history.length - index,
                "รหัสสินค้า": item.code,
                "ชื่อสินค้า": item.name,
                "สถานะ": item.status === 'shipping' ? "กำลังจัดส่ง" : "ได้รับแล้ว",
                "เวลา": item.time,
                "วันที่": new Date().toLocaleDateString('th-TH')
            }));
            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "KanbanHistory");
            XLSX.writeFile(workbook, `Kanban_Report_${new Date().getTime()}.xlsx`);
            showToast("ส่งออก Excel สำเร็จ");
        }

        function exportPDF() {
            if (history.length === 0) return showToast("ไม่มีข้อมูลให้นำออก");
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("Kanban Transaction Report", 14, 15);
            doc.setFontSize(10);
            doc.text(`Generated on: ${new Date().toLocaleString('th-TH')}`, 14, 22);
            const tableData = history.map((item, index) => [
                history.length - index,
                item.code,
                item.name,
                item.status === 'shipping' ? "Shipping" : "Delivered",
                item.time
            ]);
            doc.autoTable({
                head: [['#', 'Code', 'Product Name', 'Status', 'Time']],
                body: tableData,
                startY: 30,
                theme: 'striped',
                headStyles: { fillStyle: [99, 102, 241] }
            });
            doc.save(`Kanban_Report_${new Date().getTime()}.pdf`);
            showToast("ส่งออก PDF สำเร็จ");
        }

        // --- UI UTILS ---

        function switchMode(mode) {
            stopCamera(); closeResult();
            const slider = document.getElementById('modeSlider');
            const pos = { scan: 0, manual: 1, import: 2 };
            if (slider) slider.style.transform = `translateX(${pos[mode] * 100}%)`;
            document.getElementById('scanView').classList.toggle('hidden', mode !== 'scan');
            document.getElementById('manualView').classList.toggle('hidden', mode !== 'manual');
            document.getElementById('importView').classList.toggle('hidden', mode !== 'import');
            
            // ล้างค่าเมื่อสลับโหมด
            if (mode === 'manual') {
                document.getElementById('manualInput').value = "";
                document.getElementById('manualInput').focus();
            }
        }

        function closeResult() { document.getElementById('resultArea').classList.add('hidden'); }

        async function toggleCamera() {
            if (isCamOpen) stopCamera();
            else {
                scanner = new Html5Qrcode("reader");
                try {
                    await scanner.start({ facingMode: "environment" }, { fps: 15, qrbox: 250 }, (text) => { handleScan(text); stopCamera(); });
                    isCamOpen = true;
                    document.getElementById('scanPlaceholder').classList.add('hidden');
                    document.getElementById('btnToggleCam').innerHTML = '<i data-lucide="camera-off"></i> <span>ปิดกล้อง</span>';
                    if(window.lucide) lucide.createIcons();
                } catch (e) { showToast("Error Camera"); }
            }
        }

        function stopCamera() {
            if (scanner && isCamOpen) {
                scanner.stop(); isCamOpen = false;
                document.getElementById('scanPlaceholder').classList.remove('hidden');
                document.getElementById('btnToggleCam').innerHTML = '<i data-lucide="camera"></i> <span>เริ่มสแกน QR Code</span>';
                if(window.lucide) lucide.createIcons();
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.classList.remove('opacity-0', 'translate-y-10'); t.classList.add('opacity-100', 'translate-y-0');
            setTimeout(() => { t.classList.add('opacity-0', 'translate-y-10'); }, 2000);
        }

        function clearHistory() { if (confirm("ล้างประวัติทั้งหมด?")) { history = []; renderHistory(); } }
        function logout() { stopCamera(); history = []; document.getElementById('loginOverlay').classList.remove('hidden'); document.getElementById('app').classList.add('hidden'); }
        window.onload = () => { if(window.lucide) lucide.createIcons(); };
    </script>
</body>
</html>